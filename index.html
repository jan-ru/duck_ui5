<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DuckDB-WASM Parquet Viewer</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #999; padding: 5px 10px; }
  </style>
</head>
<body>
  <h1>DuckDB-WASM Parquet Viewer</h1>
  <input type="file" id="file" accept=".parquet">
  <div id="out"></div>

  <script type="module">
    import * as duckdb from "https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm/+esm";

    const input = document.getElementById("file");
    const out = document.getElementById("out");

    // Convert array of objects to HTML table
    function renderTable(rows) {
      if (!rows.length) return "<p>No data</p>";
      const headers = Object.keys(rows[0]);
      return `
        <table>
          <thead>
            <tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>
          </thead>
          <tbody>
            ${rows.map(r => `<tr>${headers.map(h => `<td>${r[h]}</td>`).join("")}</tr>`).join("")}
          </tbody>
        </table>
      `;
    }

    input.onchange = async () => {
      const file = input.files[0];
      if (!file) return;

      // Load DuckDB-WASM bundle
      const bundles = duckdb.getJsDelivrBundles();
      const bundle = await duckdb.selectBundle(bundles);
      const worker = new Worker(URL.createObjectURL(
        new Blob([`importScripts("${bundle.mainWorker}")`])
      ));

      const db = new duckdb.AsyncDuckDB(new duckdb.ConsoleLogger(), worker);
      await db.instantiate(bundle.mainModule);
      const conn = await db.connect();

      // Register the uploaded Parquet file
      await db.registerFileHandle(
        "data.parquet",
        file,
        duckdb.DuckDBDataProtocol.BROWSER_FILEREADER
      );

      // Query the Parquet file
      const result = await conn.query(`SELECT * FROM read_parquet('data.parquet')`);
      const rows = result.toArray();

      // Display as table
      out.innerHTML = renderTable(rows);
    };
  </script>
</body>
</html>
